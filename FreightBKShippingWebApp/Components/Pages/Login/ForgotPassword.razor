@layout EmptyLayout
@page "/forgot"
@using System.ComponentModel.DataAnnotations
@using FreightBKShippingWebApp.Model
@using FreightBKShippingWebApp.Services
@inject AuthService AuthService
@inject ToasteService ToastService

@rendermode InteractiveServer

<AuthCardLayout TModel="EmailOnlyDto"
                HeaderTitle="Forgot Password"
                HeaderSubtitle="We’ll help you reset your password 🔒"
                HeaderIcon="fa-unlock-alt" HeaderTextColor="text-primary"
                HeaderIconClass="bg-primary bg-gradient"
                BackgroundGradient="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">

    <ChildContent>
        <EditForm Model="@forgotPasswordModel" OnValidSubmit="OnSubmitForgotPassword">
            <DataAnnotationsValidator />
            <ValidationSummary />

            <!-- Email -->
            <div class="mb-3">
                <label>Email</label>
                <DxTextBox @bind-Text="forgotPasswordModel.Email"
                           CssClass="form-control"
                           NullText="Enter your email" />
            </div>

            <!-- Submit Button -->
            <DxButton SubmitFormOnClick="true"
                      Text="Send Reset Link"
                      CssClass="btn btn-primary w-100" />
        </EditForm>

        @if (!string.IsNullOrEmpty(message))
        {
            <div class="alert alert-@alertType mt-3">
                @message
            </div>
        }
    </ChildContent>

    <FooterContent>
        <p>Back to <a href="/">Login</a></p>
    </FooterContent>
</AuthCardLayout>

@code {
    private EmailOnlyDto forgotPasswordModel = new();
    private string? message;
    private string alertType = "info";

    private async Task OnSubmitForgotPassword()
    {
        try
        {
            var response = await AuthService.ForgotPasswordAsync(forgotPasswordModel.Email);

            if (response.IsSuccess)
            {
                ToastService.Success("If the email is registered, a reset link has been sent.");

               
            }
            else
            {
                ToastService.Error(response.ErrorMessage ?? "Failed to send reset link.");
            }
        }
        catch (Exception ex)
        {
            message = $"⚠️ Something went wrong: {ex.Message}";
            alertType = "danger";
        }
    }

}

